<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="telegram-web-app-cloud-storage" content="true">
    <title>Telegotchi</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div id="app">
        <h1>Telegotchi</h1>
        <div id="pet-stage">
            <img id="pet" src="egg.png" alt="Telegotchi">
            <p id="status">Eclosionando...</p>
        </div>

        <div id="controls" style="display:none;">
            <button onclick="feed()">🍖 Alimentar</button>
            <button onclick="play()">🎮 Jugar</button>
            <button onclick="sleep()">😴 Dormir</button>
            <button onclick="clean()">🧼 Limpiar</button>
        </div>

        <div id="stats">
            <p>Hambre: <span id="hunger">5</span></p>
            <p>Felicidad: <span id="happiness">5</span></p>
            <p>Energía: <span id="energy">5</span></p>
            <p>Limpieza: <span id="cleanliness">5</span></p>
            <p>💰 Dinero: $<span id="money">0</span></p>
        </div>

        <div id="shop">
            <h2>Tienda</h2>
            <button onclick="buyItem('food')">Comprar comida ($5)</button>
            <button onclick="buyItem('toy')">Comprar juguete ($10)</button>
        </div>
    </div>

    <script>
        let hunger = 5, happiness = 5, energy = 5, cleanliness = 5, money = 0;
        let stage = 'egg';

        async function loadState() {
            try {
                const keys = await Telegram.WebApp.CloudStorage.getKeys();
                const data = await Telegram.WebApp.CloudStorage.getItems(keys);
                hunger = parseInt(data.hunger) || 5;
                happiness = parseInt(data.happiness) || 5;
                energy = parseInt(data.energy) || 5;
                cleanliness = parseInt(data.cleanliness) || 5;
                money = parseInt(data.money) || 0;
                stage = data.stage || 'egg';
                updatePetStage();
                updateStats();
            } catch (err) {
                console.warn('No se pudo cargar el estado:', err);
            }
        }

        async function saveState() {
            try {
                await Telegram.WebApp.CloudStorage.setItems({
                    hunger: hunger.toString(),
                    happiness: happiness.toString(),
                    energy: energy.toString(),
                    cleanliness: cleanliness.toString(),
                    money: money.toString(),
                    stage: stage
                });
            } catch (err) {
                console.warn('No se pudo guardar el estado:', err);
            }
        }

        function updateStats() {
            document.getElementById('hunger').innerText = hunger;
            document.getElementById('happiness').innerText = happiness;
            document.getElementById('energy').innerText = energy;
            document.getElementById('cleanliness').innerText = cleanliness;
            document.getElementById('money').innerText = money;
            saveState();
        }

        function updatePetStage() {
            const petImg = document.getElementById('pet');
            const statusText = document.getElementById('status');
            const controls = document.getElementById('controls');

            if (stage === 'baby') {
                petImg.src = 'pet.png';
                statusText.innerText = '¡Hola! Soy tu Telegotchi';
                controls.style.display = 'block';
            } else {
                petImg.src = 'egg.png';
                statusText.innerText = 'Eclosionando...';
            }
        }

        function feed() {
            if (money >= 5) {
                hunger = Math.min(10, hunger + 2);
                money -= 5;
                updateStats();
            } else alert('¡No tienes suficiente dinero!');
        }

        function play() {
            happiness = Math.min(10, happiness + 2);
            energy = Math.max(0, energy - 1);
            money += 1;
            updateStats();
        }

        function sleep() {
            energy = 10;
            happiness = Math.max(0, happiness - 1);
            updateStats();
        }

        function clean() {
            cleanliness = 10;
            money += 1;
            updateStats();
        }

        function buyItem(type) {
            if (type === 'food' && money >= 5) {
                money -= 5;
                hunger = Math.min(10, hunger + 3);
            } else if (type === 'toy' && money >= 10) {
                money -= 10;
                happiness = Math.min(10, happiness + 3);
            } else {
                alert('¡No tienes suficiente dinero!');
                return;
            }
            updateStats();
        }

        function hatch() {
            setTimeout(() => {
                stage = 'baby';
                updatePetStage();
                updateStats();
            }, 3000);
        }

        Telegram.WebApp.ready();
        loadState().then(() => {
            if (stage === 'egg') hatch();
        });
    </script>
</body>
</html>
